Как указано в ТЗ;Текущая Логика;Чтог нужно изменить на бэке;что нужно изменить на рфонте;рекомендации
"Клик по заблокированному бусту: всегда открывается плашка с описанием. Тексты: в 'Трансферы' — 'Чтобы использовать этот буст, отмените активированный буст в разделе “Моя команда”'; в 'Моя команда' — либо 'отмените активированный буст в разделе “Моя команда”', либо 'Вы уже используете буст в разделе “Трансферы”. Его нельзя отменить'";При заблокированном бусте на другой странице плашка вообще не открывается, показывается только toast ('В этом туре уже активирован буст в разделе Трансферы/Управление командой'). При заблокированном другом бусте в том же разделе в плашке универсальный текст 'В этом туре уже активирован другой буст... Отмени его, чтобы использовать ...', без упоминания конкретного раздела и невозможности отмены трансферных бустов;Необязательно: можно добавить в API явное поле, где активирован текущий буст (section/page), чтобы фронт строил тексты строго по данным бэка;"Разрешить открытие BoostDrawer и для заблокированных бустов. В BoostDrawer и местах вызова (TeamManagement, Transfers) добавить разные тексты для: 1) заблокирован бустом в 'Моя команда'; 2) заблокирован бустом в 'Трансферы'; 3) заблокирован внутри того же раздела. Тексты привести к формулировкам из ТЗ, заменить текущие toast-сообщения на информативные плашки";Свести всю обработку кликов по бустам к единому сценарию 'открыли плашку, показали описание + причину блокировки', уйти от логики 'просто показать toast и ничего не открыть'
"Отмена бустов: в 'Моя команда' буст можно отменить только до дедлайна тура; в 'Трансферы' после подтверждения отменить нельзя";На 'Моя команда' отмена (cancel/remove) вообще никак не завязана на дедлайн, доступна всегда с точки зрения фронта. На 'Трансферы' фактически отмены нет (canCancel=false в BoostDrawer для transfers/golden), но существует скрытый код removeBoost с DELETE /remove, который теоретически может быть активирован;На бэке уже должен быть контроль дедлайна для DELETE/POST. Если его нет — добавить проверку дедлайна и возвращать ошибку при попытке отмены после дедлайна тура;На 'Моя команда' при попытке отмены проверять дедлайн (через useDeadline/флаг с бэка) и блокировать отмену/менять текст кнопки после дедлайна. На 'Трансферы' удалить/не использовать onRemove для transfers/golden, чтобы нигде нельзя было случайно сделать DELETE. В BoostDrawer для трансферных бустов оставить только просмотр описания;По возможности не дублировать бизнес-ограничения в UI, а опираться на ответ бэка (ошибка при DELETE после дедлайна) и просто отображать читабельное сообщение пользователю
Бусты можно использовать только один раз за сезон и только по одному бусту в каждом туре;Для bench/captain3x/double и 'golden' это реализуется через available/used_in_tour_number с бэка и фронтовые статусы 'used'. Для 'Трансферы+' локальное состояние pendingBoostId хранится без тура и не сбрасывается, поэтому фронт считает его активным во всех будущих турах, блокируя командные бусты и давая бесконечные бесплатные трансферы;Если бэк уже гарантирует, что один и тот же буст нельзя применить дважды (по типу буста и сезону) — менять ничего не нужно, проблема во фронте. Если нет — на уровне хранения истории бустов сделать ограничение '1 раз в сезон' по типу;В BoostState добавить pendingBoostTour, при применении буста записывать boostTourId. При смене тура или при подтверждении с бэка (GET /available) очищать/конвертировать pending → used только для соответствующего тура. В hasAnyPendingBoost и transferState учитывать тур, чтобы буст не считался активным бесконечно;Критично аккуратно разделить понятия 'активен на следующий тур' и 'уже был когда-то использован'. Всё, что про 'уже использован', должно опираться только на бэк, а не на localStorage
Трансферные бусты действуют только в одном туре: 'Трансферы+' делает все трансферы тура бесплатными, 'Золотой тур' делает трансферы тура бесплатными с откатом состава в конец тура;В transferState persistentBoostActive проверяет только pendingBoostId/pendingBoostPage и не привязан к туру, поэтому после первого использования 'transfers' эффект 'все трансферы бесплатны' действует вечно. Для 'golden' состояние более корректно сбрасывается через markBoostAsUsed в League.tsx, но оно привязано к локальному currentTour=1 (заглушка) и контролируется сторонним эффектом из страницы Лиги;На бэке гарантировать, что эффект каждого буста привязан к конкретному туру, и при расчёте штрафа/лимита использовать только фактически активный в туре буст, а не глобальный флаг. В ответах /available и/или /squads отдавать явный флаг 'в этом туре активен такой-то буст';"В transferState: 1) убрать жёсткую заглушку getCurrentTour=1, читать текущий тур либо из useSquadData либо из API; 2) persistentBoostActive считать true только при совпадении pendingBoostTour с текущим туром; 3) по завершению тура вызывать markBoostAsUsed для трансферных бустов и очищать pending. Убрать зависимость от побочного эффекта в League.tsx для Golden Tour и строить состояние бустов по данным /available";Стремиться к тому, чтобы фронт вообще не вычислял долгосрочное состояние трансферов, а только показывал данные, посчитанные бэком (штраф, сколько трансферов бесплатные и т.п.)
Отображение использованных бустов: 'Использован во 2-м туре' (и на плитке, и в описании);На плитках (TeamManagement/Transfers) сублейбл строится как 'Использован в X туре'. В BoostDrawer текст для описания использованного буста — 'Использовано в X туре' (другое окончание и без 'во');Менять ничего не обязательно, это чисто фронтовая формулировка;Унифицировать строки: сделать везде 'Использован во X туре' (или другую выбранную форму) и использовать один источник форматирования текста (утилита/функция), а не дублировать строку в разных файлах;Пройтись по всем текстовым формулировкам бустов и привести их к единому стилю, чтобы не путать пользователя мелкими различиями
Статусы заблокированных бустов: статус 'Заблокирован' под плиткой;На разных плитках используются разные формы: где-то 'Заблокирован', где-то 'Заблокировано', иногда показывается просто 'N тур' без слова 'Использован', а иногда текст из sublabel ('Недоступен (буст уже выбран на следующий тур)');Не требуется, это отображение;В компонентах плиток (сет ап бустов в TeamManagement/Transfers) унифицировать условие для заблокированных бустов и всегда показывать 'Заблокирован' под ними. Текст 'Недоступен (буст уже выбран на следующий тур)' оставить только как вспомогательный в описании, либо вынести в отдельный статус;Вынести статусы бустов (available/pending/used/blocked) в один enum с заранее описанными подписями, чтобы не размазывать строки по коду
Описание бустов: нигде явно не вводится понятие 'накопленные бесплатные трансферы', при этом отдельным пунктом ТЗ сказано, что трансферы не накапливаются и каждый тур даёт фиксированные 2 трансфера;В BoostDrawer описания 'Трансферы+' и 'Золотой тур' оперируют 'накопленными бесплатными трансферами': для 'Трансферы+' — 'накопленные до активации... сгорают', для 'Золотого тура' — 'накопленные бесплатные трансферы НЕ сгорают'. Это противоречит базовому правилу 'трансферы не накапливаются' и вводит в модель несуществующий сейчас механизм;"Если бэк реально не поддерживает накопление трансферов, ничего менять не нужно; если в планах есть фича накопления, то ТЗ/фронт нужно обновить под новую механику";Либо убрать упоминания 'накопленных бесплатных трансферов' из описаний, либо (если такая механика действительно будет) согласовать с бэком конкретную модель накопления и синхронизировать все тексты. Сейчас лучше убрать эти фразы, чтобы не ломать пользовательские ожидания;Сначала синхронизировать ТЗ и бизнес-логику: есть ли вообще концепция накопления трансферов. Уже после этого приводить описания бустов в соответствие, чтобы игрокам было понятно, что происходит
Базовое правило трансферов: 'В каждом туре пользователю автоматически даётся 2 трансфера... Трансферы не накапливаются';В UI количество свободных трансферов берётся с бэка (squad.replacements), что корректно. Но в transferState локальная логика опирается на FREE_TRANSFERS_PER_TOUR=2 и getCurrentTour(), который всегда возвращает 1 (заглушка) — из-за этого локальное состояние 'туров' на фронте не меняется. В сочетании с багом persistentBoostActive штраф может не считаться корректно;Бэк, судя по squad.replacements и расчёту штрафа, уже реализует нужную механику. Главное — не полагаться на фронт для окончательного расчёта;Либо полностью убрать локальный transferState и считать штраф/бесплатные трансферы только по данным с бэка, либо сделать getCurrentTour() настоящим и использовать его только как вспомогательную локальную статистику. Сейчас локальная логика создаёт риск расхождения с серверным расчётом;Лучше всего: бэк считает штрафы и количество использованных transfer'ов, фронт только отображает. Любые сложные расчёты на клиенте должны быть чисто UX (подсказки до сохранения), а не источник истины
Отображение активного буста на следующий тур: выбранный буст подсвечен как активный, остальные для этого тура заблокированы;На 'Моя команда' это реализовано: activeNextTourBoostChipId определяется из used_for_next_tour/used_in_tour_number, активный буст показывается как pending с 'Используется', остальные командные бусты в этом туре получают статус 'Заблокирован'. На 'Трансферы' активный буст для следующего тура определяется только по локальному pendingBoostId, и если зайти с чистым localStorage в тур, где по бэку уже стоит активный трансферный буст, он будет выглядеть просто как 'использован в N туре', без выделения 'активен в следующем туре';На бэке уже есть used_for_next_tour и used_in_tour_number. Можно, при необходимости, добавить отдельное поле 'boost_for_next_tour' по типу, чтобы фронт точно знал, какой буст активен именно для ближайшего тура;На 'Трансферы' отразить ту же модель, что и на 'Моя команда': вычислять 'активный буст на следующий тур' по данным /available (used_for_next_tour + used_in_tour_number), подсвечивать его как активный, а остальные бусты в этом туре помечать заблокированными. Не полагаться только на pendingBoost из localStorage;Сделать единую функцию, которая по ответу /available строит 'карточку состояния' всех 5 бустов (активен сейчас, выбран на следующий тур, использован ранее, заблокирован) и переиспользовать её на обеих страницах, чтобы не было расхождений
Клики по уже использованным в прошлых турах бустам: показывается описание и статус 'Использован во 2-м туре';Плашка BoostDrawer действительно показывает описание и статус использования, но текст/формат ('Использовано в X туре') отличается от плитки ('Использован в X туре'), и часть логики 'used' на плитке опирается на локальное состояние, а не только на бэкенд (есть риск неконсистентности при манипуляциях с localStorage);Бэк уже отдаёт used_in_tour_number, менять ничего не нужно;Везде, где определяется статус 'used', ориентироваться только на API-данные (available=false + used_in_tour_number), не использовать локальные usedBoosts/markBoostAsUsed за исключением специализированного кейса Golden Tour (бэкап состава). Формат текста унифицировать;Чем меньше фронт сам придумывает статусы бустов, тем стабильнее поведение. Для длительного состояния ('этот буст уже использован') всегда опираться только на данные, которые пришли с сервера
