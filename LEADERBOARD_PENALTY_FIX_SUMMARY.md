# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã—á–∏—Ç–∞–Ω–∏—è —à—Ç—Ä–∞—Ñ–æ–≤ –≤–æ –≤—Å–µ—Ö –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞—Ö

**–î–∞—Ç–∞:** 1 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–Å –ò–°–ü–†–ê–í–õ–ï–ù–û**

## üìä –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–í–æ –≤—Å–µ—Ö –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞—Ö (–≥–ª–∞–≤–Ω—ã–π, –∫–ª—É–±–Ω—ã–µ, –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ) —à—Ç—Ä–∞—Ñ–Ω—ã–µ –æ—á–∫–∏ –≤—ã—á–∏—Ç–∞–ª–∏—Å—å **–î–í–ê–ñ–î–´**:
1. ‚úÖ –ù–∞ –±—ç–∫–µ–Ω–¥–µ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
2. ‚ùå –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ (–æ—à–∏–±–æ—á–Ω–æ)

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (Frontend)

### –ö–æ–º–º–∏—Ç 1: `4b8e764`

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≥–ª–∞–≤–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥:

1. ‚úÖ **src/pages/League.tsx** (—Å—Ç—Ä–æ–∫–∞ 681)
   - **–ë–´–õ–û:** `{(row.totalPoints - (row.totalPenaltyPoints || 0)).toLocaleString()}`
   - **–°–¢–ê–õ–û:** `{row.totalPoints.toLocaleString()}`

### –ö–æ–º–º–∏—Ç 2: `7d77520`

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã:

2. ‚úÖ **src/pages/TournamentTable.tsx** (—Å—Ç—Ä–æ–∫–∞ 226)
   - –ì–ª–∞–≤–Ω–∞—è —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)
   
3. ‚úÖ **src/pages/ViewComLeague.tsx** (—Å—Ç—Ä–æ–∫–∞ 279)
   - –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ª–∏–≥
   
4. ‚úÖ **src/pages/ViewUserLeague.tsx** (—Å—Ç—Ä–æ–∫–∞ 299)
   - –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ª–∏–≥
   
5. ‚úÖ **src/pages/ViewLeague.tsx** (—Å—Ç—Ä–æ–∫–∞ 260)
   - –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–ª—É–±–Ω—ã—Ö –ª–∏–≥

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:** –£–¥–∞–ª–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ `(row.totalPenaltyPoints || 0)`

---

## üéØ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ **–£–ñ–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É**:

### 1. –ì–ª–∞–≤–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ ‚úÖ
```
GET /api/squads/leaderboard/{tour_id}
```

**–ö–æ–¥:** `app/squads/services.py:871-936`

```python
"tour_points": points.tour_net,        # –ß–∏—Å—Ç—ã–µ –æ—á–∫–∏ —Ç—É—Ä–∞
"total_points": points.total_earned,   # –ë—Ä—É—Ç—Ç–æ-–æ—á–∫–∏ (–ë–ï–ó –≤—ã—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–æ–≤)
"penalty_points": points.tour_penalty,
"total_penalty_points": points.total_penalty,
```

### 2. –ö–ª—É–±–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ ‚úÖ
```
GET /api/squads/leaderboard/{tour_id}/by-fav-team/{fav_team_id}
```

**–ö–æ–¥:** `app/squads/services.py:1382-1457`

```python
"tour_points": points.tour_net,
"total_points": points.total_earned,
"penalty_points": points.tour_penalty,
"total_penalty_points": points.total_penalty,
```

### 3. –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ª–∏–≥–∏ ‚úÖ
```
GET /api/commercial_leagues/{commercial_league_id}/leaderboard/{tour_id}
```

**–ö–æ–¥:** `app/custom_leagues/commercial_league/services.py:73-128`

```python
"tour_points": points.tour_net,
"total_points": points.total_earned,
"penalty_points": points.tour_penalty,
"total_penalty_points": points.total_penalty,
```

### 4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ª–∏–≥–∏ ‚úÖ
```
GET /api/user_leagues/{user_league_id}/leaderboard/{tour_id}
```

**–ö–æ–¥:** `app/custom_leagues/user_league/services.py:276-333`

```python
"tour_points": points.tour_net,
"total_points": points.total_earned,
"penalty_points": points.tour_penalty,
"total_penalty_points": points.total_penalty,
```

---

## üìä –°–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–æ–ª–µ–π API

| –ü–æ–ª–µ API | –†–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç |
|----------|-------------------|---------------------|
| `total_points` | `total_earned` (–±—Ä—É—Ç—Ç–æ-–æ—á–∫–∏) | –ë—Ä—É—Ç—Ç–æ-–æ—á–∫–∏ |
| `total_penalty_points` | –°—É–º–º–∞ –≤—Å–µ—Ö —à—Ç—Ä–∞—Ñ–æ–≤ | –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Total |
| `tour_points` | `tour_net` (—á–∏—Å—Ç—ã–µ –æ—á–∫–∏ —Ç—É—Ä–∞) | –û—á–∫–∏ –∑–∞ —Ç—É—Ä |
| `penalty_points` | –®—Ç—Ä–∞—Ñ —Ç–µ–∫—É—â–µ–≥–æ —Ç—É—Ä–∞ | –ú–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ |

**–í–∞–∂–Ω–æ:** –ü–æ–ª–µ `total_points` **–ù–ï —è–≤–ª—è–µ—Ç—Å—è** —á–∏—Å—Ç—ã–º–∏ –æ—á–∫–∞–º–∏ ‚Äî —ç—Ç–æ –±—Ä—É—Ç—Ç–æ-–æ—á–∫–∏ (`total_earned`).

---

## üéØ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å—Ç—ã–µ –æ—á–∫–∏?

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å **—á–∏—Å—Ç—ã–µ –æ—á–∫–∏** (Net Total):

```typescript
const netTotal = row.totalPoints - (row.totalPenaltyPoints || 0);
```

–ù–æ —Å–µ–π—á–∞—Å –≤–æ –≤—Å–µ—Ö –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **–±—Ä—É—Ç—Ç–æ-–æ—á–∫–∏** (Gross Total):

```typescript
const grossTotal = row.totalPoints;  // –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

### Frontend (tele-mini-sparkle)

**–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 5  
**–ö–æ–º–º–∏—Ç—ã:**
- `4b8e764` ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≥–ª–∞–≤–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ + –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `7d77520` ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã

**–ó–∞–ø—É—à–µ–Ω–æ:** ‚úÖ `origin/main`

### Backend (sporttg)

**–ò–∑–º–µ–Ω–µ–Ω–∏–π:** ‚ùå –ù–µ—Ç  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–∞—Å—á—ë—Ç–∞ —á–µ—Ä–µ–∑ `calculate_squad_points_bulk()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª—è.

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

‚úÖ –ì–ª–∞–≤–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ (`/league`)  
‚úÖ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (`/tournament-table`)  
‚úÖ –ö–ª—É–±–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ (`/view-league?type=club`)  
‚úÖ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ª–∏–≥–∏ (`/view-com-league`)  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ª–∏–≥–∏ (`/view-user-league`)

**–í—Å–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –æ—á–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ!**

---

## üìù –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- ‚úÖ `PENALTY_DOUBLE_DEDUCTION_BUG_FIX.md` ‚Äî –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∞–≥–∞
- ‚úÖ `POINTS_LOGIC_EXPLANATION.md` ‚Äî –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤
- ‚úÖ `TOUR_STATES_EXPLANATION.md` ‚Äî –°–æ—Å—Ç–æ—è–Ω–∏—è —Ç—É—Ä–æ–≤ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- ‚úÖ `DEPRECATED_ENDPOINTS_AUDIT.md` ‚Äî –ê—É–¥–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ API

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ë–∞–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—ë–Ω!** –®—Ç—Ä–∞—Ñ—ã –±–æ–ª—å—à–µ –Ω–µ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –¥–≤–∞–∂–¥—ã –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏–∑ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤.
