# –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤ –≤ —Ñ—ç–Ω—Ç–µ–∑–∏-–ª–∏–≥–µ

**–î–∞—Ç–∞:** 1 —Ñ–µ–≤—Ä–∞–ª—è 2026

## üìä –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç –æ—á–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ **—Ç—É—Ä–∞** (SquadTour) –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö –≤ **–æ–±—â–∏–π —Å—á—ë—Ç** (Total). –ö–∞–∂–¥—ã–π —Ç—É—Ä ‚Äî —ç—Ç–æ —Å–Ω–∞–ø—à–æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Å –Ω–∞–±—Ä–∞–Ω–Ω—ã–º–∏ –æ—á–∫–∞–º–∏ –∏ —à—Ç—Ä–∞—Ñ–∞–º–∏.

---

## üéØ –ë–∞–∑–æ–≤—ã–µ –æ—á–∫–∏ –∏–≥—Ä–æ–∫–∞

### –†–∞—Å—á—ë—Ç –æ—á–∫–æ–≤ –∏–≥—Ä–æ–∫–∞ (`count_points.py`)

–û—á–∫–∏ –∏–≥—Ä–æ–∫–∞ –∑–∞ –º–∞—Ç—á —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

| –î–µ–π—Å—Ç–≤–∏–µ | –§–æ—Ä–º—É–ª–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|---------|------------|
| **–í—Ä–µ–º—è –Ω–∞ –ø–æ–ª–µ** | `–º–∏–Ω—É—Ç—ã √∑ 60` | –ó–∞ –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç +1 –±–∞–ª–ª |
| **–ì–æ–ª—ã** | `–≥–æ–ª—ã √ó 5` | +5 –±–∞–ª–ª–æ–≤ –∑–∞ –≥–æ–ª |
| **–ê—Å—Å–∏—Å—Ç—ã** | `–∞—Å—Å–∏—Å—Ç—ã √ó 3` | +3 –±–∞–ª–ª–∞ –∑–∞ –ø–µ—Ä–µ–¥–∞—á—É |
| **"–°—É—Ö–æ–π" –º–∞—Ç—á (GK)** | `+5` | –ï—Å–ª–∏ –≤—Ä–∞—Ç–∞—Ä—å, –º–∏–Ω—É—Ç ‚â•60, –ø—Ä–æ–ø—É—â–µ–Ω–æ 0 –≥–æ–ª–æ–≤ |
| **–ñ—ë–ª—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞** | `-1` | –®—Ç—Ä–∞—Ñ –∑–∞ –ñ–ö |
| **–í—Ç–æ—Ä–∞—è –∂—ë–ª—Ç–∞—è** | `-2` | –î–≤–æ–π–Ω–æ–π —à—Ç—Ä–∞—Ñ |
| **–ö—Ä–∞—Å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞** | `-3` | –¢—Ä–æ–π–Ω–æ–π —à—Ç—Ä–∞—Ñ |
| **–ù–µ–∑–∞–±–∏—Ç—ã–π –ø–µ–Ω–∞–ª—å—Ç–∏** | `-2` | –ó–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–º–∞—Ö |

**–ú–∏–Ω–∏–º—É–º:** –û—á–∫–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ (–µ—Å–ª–∏ –∏—Ç–æ–≥ < 0, –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è 0).

**–ö–æ–¥:** `app/utils/count_points.py:1-30`

---

## üèÜ –û—á–∫–∏ –∑–∞ —Ç—É—Ä (Tour Points)

### 1. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É—Ä–∞

–ö–æ–≥–¥–∞ —Ç—É—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –∑–∞ –º–∞—Ç—á–∏ —Ç—É—Ä–∞
2. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—á–∫–∏** –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ `count_points.py`
3. **–°—É–º–º–∏—Ä—É–µ—Ç –æ—á–∫–∏** –∫–æ–º–∞–Ω–¥—ã —Å —É—á—ë—Ç–æ–º –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π (–∫–∞–ø–∏—Ç–∞–Ω, –±—É—Å—Ç—ã)
4. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç** –≤ `SquadTour.points`
5. **–ü–æ–º–µ—á–∞–µ—Ç —Ç—É—Ä** –∫–∞–∫ `is_finalized = True`

**–ú–µ—Ç–æ–¥:** `SquadService.finalize_tour()` (—Å—Ç—Ä–æ–∫–∏ 1193-1298)

### 2. –†–∞—Å—á—ë—Ç –æ—á–∫–æ–≤ —Ç—É—Ä–∞

```python
async def calculate_points(self, session) -> int:
    total_points = 0
    
    # –°—É–º–º–∞ –æ—á–∫–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞ (11 –∏–≥—Ä–æ–∫–æ–≤)
    for player in self.main_players:
        total_points += player_points_for_tour
    
    # –°—É–º–º–∞ –æ—á–∫–æ–≤ —Å–∫–∞–º–µ–π–∫–∏ (4 –∏–≥—Ä–æ–∫–∞)
    for player in self.bench_players:
        total_points += player_points_for_tour
    
    return total_points
```

**–ö–æ–¥:** `app/squad_tours/models.py:123-144`

### 3. –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –æ—á–∫–æ–≤ (Frontend)

–ù–∞ **—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º –æ—á–∫–∞–º:

| –†–æ–ª—å | –ú–Ω–æ–∂–∏—Ç–µ–ª—å | –£—Å–ª–æ–≤–∏–µ |
|------|-----------|---------|
| **–ö–∞–ø–∏—Ç–∞–Ω** | √ó2 | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **–ö–∞–ø–∏—Ç–∞–Ω** | √ó3 | –ë—É—Å—Ç "3x Captain" –∞–∫—Ç–∏–≤–µ–Ω |
| **–í–∏—Ü–µ-–∫–∞–ø–∏—Ç–∞–Ω** | √ó2 | –ë—É—Å—Ç "Double Power" –∞–∫—Ç–∏–≤–µ–Ω |
| **–ò–≥—Ä–æ–∫–∏ —Å–∫–∞–º–µ–π–∫–∏** | +–æ—á–∫–∏ | –ë—É—Å—Ç "Bench+" –∞–∫—Ç–∏–≤–µ–Ω |

**–ö–æ–¥:** `src/lib/pointsCalculation.ts:47-73`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ë—ç–∫–µ–Ω–¥ **–ù–ï** –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.

---

## üìà –û–±—â–∏–µ –æ—á–∫–∏ (Total Points)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Squad (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã)
  ‚îú‚îÄ‚îÄ SquadTour #1 (–¢—É—Ä 1)  ‚Üê points: 45, penalty_points: 0
  ‚îú‚îÄ‚îÄ SquadTour #2 (–¢—É—Ä 2)  ‚Üê points: 52, penalty_points: 4
  ‚îú‚îÄ‚îÄ SquadTour #3 (–¢—É—Ä 3)  ‚Üê points: 38, penalty_points: 8
  ‚îî‚îÄ‚îÄ ...
```

### –§–æ—Ä–º—É–ª—ã

#### 1. **Total Earned Points** (–í—Å–µ–≥–æ –Ω–∞–±—Ä–∞–Ω–æ)
```sql
SUM(SquadTour.points) WHERE squad_id = X
```

**–ü—Ä–∏–º–µ—Ä:**
- –¢—É—Ä 1: 45 –æ—á–∫–æ–≤
- –¢—É—Ä 2: 52 –æ—á–∫–∞
- –¢—É—Ä 3: 38 –æ—á–∫–æ–≤
- **Total Earned = 45 + 52 + 38 = 135**

#### 2. **Total Penalty Points** (–í—Å–µ–≥–æ —à—Ç—Ä–∞—Ñ–æ–≤)
```sql
SUM(SquadTour.penalty_points) WHERE squad_id = X
```

**–ü—Ä–∏–º–µ—Ä:**
- –¢—É—Ä 1: 0 —à—Ç—Ä–∞—Ñ–∞
- –¢—É—Ä 2: -4 —à—Ç—Ä–∞—Ñ–∞ (1 –ø–ª–∞—Ç–Ω–∞—è –∑–∞–º–µ–Ω–∞)
- –¢—É—Ä 3: -8 —à—Ç—Ä–∞—Ñ–æ–≤ (2 –ø–ª–∞—Ç–Ω—ã–µ –∑–∞–º–µ–Ω—ã)
- **Total Penalty = 0 + 4 + 8 = 12**

#### 3. **Total Net Points** (–ß–∏—Å—Ç—ã–µ –æ—á–∫–∏ ‚Äî –í–°–ï–ì–û)
```
total_net = total_earned - total_penalty
```

**–ü—Ä–∏–º–µ—Ä:** `135 - 12 = 123 –æ—á–∫–∞`

**–ö–æ–¥:** `app/squads/services.py:792-868` (–º–µ—Ç–æ–¥ `calculate_squad_points_bulk`)

---

## ‚öñÔ∏è –®—Ç—Ä–∞—Ñ–Ω—ã–µ –æ—á–∫–∏ (Penalty Points)

### –ü—Ä–∞–≤–∏–ª–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –∑–∞ —Ç—É—Ä | **2** |
| –®—Ç—Ä–∞—Ñ –∑–∞ –∫–∞–∂–¥—ã–π –ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä | **-4 –æ—á–∫–∞** |

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞

**–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `replacements = 2` (–æ—Å—Ç–∞–ª–æ—Å—å 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–º–µ–Ω—ã)

**–î–µ–π—Å—Ç–≤–∏–µ:** –ò–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç 5 –∑–∞–º–µ–Ω

**–†–∞—Å—á—ë—Ç:**
```
transfer_count = 5
free_transfers_used = min(5, 2) = 2
paid_transfers = 5 - 2 = 3
penalty = 3 √ó 4 = 12 –±–∞–ª–ª–æ–≤

SquadTour.penalty_points += 12
SquadTour.replacements = 0
```

**–ö–æ–¥:** `app/squads/services.py:1062-1083`

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–∞

–®—Ç—Ä–∞—Ñ **—Å—Ä–∞–∑—É** –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É —Ç—É—Ä—É:
```python
squad_tour.penalty_points += penalty
```

–ü—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—É—Ä–∞ —ç—Ç–æ—Ç —à—Ç—Ä–∞—Ñ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞ –∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ Total Penalty.

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö SquadPoints

```python
@dataclass
class SquadPoints:
    tour_earned: int         # –û—á–∫–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π —Ç—É—Ä
    tour_penalty: int        # –®—Ç—Ä–∞—Ñ –∑–∞ —Ç–µ–∫—É—â–∏–π —Ç—É—Ä
    total_earned: int        # –°—É–º–º–∞ –æ—á–∫–æ–≤ –≤—Å–µ—Ö —Ç—É—Ä–æ–≤
    total_penalty: int       # –°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –≤—Å–µ—Ö —Ç—É—Ä–æ–≤
    total_net: int           # total_earned - total_penalty
    tour_net: int            # tour_earned - tour_penalty
```

**–ö–æ–¥:** `app/squads/services.py:26-35`

---

## üéÆ –õ–∏–¥–µ—Ä–±–æ—Ä–¥

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–ö–æ–º–∞–Ω–¥—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ **`total_net`** (—á–∏—Å—Ç—ã–µ –æ—á–∫–∏ –∑–∞ –≤—Å–µ —Ç—É—Ä—ã):

```python
leaderboard.sort(key=lambda x: x["points"].total_net, reverse=True)
```

### –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞

```python
{
    "place": 1,
    "squad_id": 42,
    "squad_name": "Dream Team",
    "user_id": 123,
    "username": "john_doe",
    "tour_points": 52,           # tour_net (–æ—á–∫–∏ —Ç—É—Ä–∞ - —à—Ç—Ä–∞—Ñ—ã —Ç—É—Ä–∞)
    "total_points": 135,         # total_earned (–≤—Å–µ –Ω–∞–±—Ä–∞–Ω–Ω—ã–µ –æ—á–∫–∏)
    "penalty_points": 4,         # tour_penalty (—à—Ç—Ä–∞—Ñ —Ç–µ–∫—É—â–µ–≥–æ —Ç—É—Ä–∞)
    "total_penalty_points": 12,  # total_penalty (—Å—É–º–º–∞ –≤—Å–µ—Ö —à—Ç—Ä–∞—Ñ–æ–≤)
}
```

**–ö–æ–¥:** `app/squads/services.py:870-936`

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—É—Ä–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ SquadTour –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∞:

```python
SquadTour(
    squad_id=squad.id,
    tour_id=next_tour.id,
    budget=100_000,
    replacements=2,          # 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–º–µ–Ω—ã
    is_finalized=False,
    points=0,
    penalty_points=0,
    used_boost=None,
)
```

**–ö–æ–¥:** `app/squads/services.py:180-196`

### 2. –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã (–¥–æ –¥–µ–¥–ª–∞–π–Ω–∞)

–ò–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞ —Ç—É—Ä–∞:
- –ú–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–∞–≤ ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –±—é–¥–∂–µ—Ç
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç > 2 –∑–∞–º–µ–Ω ‚Üí –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —à—Ç—Ä–∞—Ñ—ã
- –®—Ç—Ä–∞—Ñ—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `SquadTour.penalty_points`

**–ö–æ–¥:** `app/squads/services.py:941-1120`

### 3. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—É—Ä–∞)

Celery-—Ç–∞—Å–∫ –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ `/finalize_tour`:
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—á–∫–∏ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –∑–∞ –º–∞—Ç—á–∏ —Ç—É—Ä–∞
- –°—É–º–º–∏—Ä—É–µ—Ç –∏—Ö ‚Üí `SquadTour.points`
- –ü–æ–º–µ—á–∞–µ—Ç `is_finalized = True`
- –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π SquadTour –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—É—Ä–∞ (–∫–æ–ø–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–∞–≤, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `replacements = 2`)

**–ö–æ–¥:** `app/squads/services.py:1193-1298`

---

## üìä API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –æ—á–∫–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—É—Ä–æ–≤ –∫–æ–º–∞–Ω–¥—ã

```
GET /api/squad_tours/squad/{squad_id}
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "tour_id": 1,
    "tour_number": 1,
    "points": 45,
    "penalty_points": 0,
    "budget": 5000,
    "replacements": 2,
    "is_finalized": true,
    "main_players": [...],
    "bench_players": [...]
  },
  ...
]
```

### –ü–æ–ª—É—á–∏—Ç—å –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —Ç—É—Ä–∞

```
GET /api/squads/leaderboard/{tour_id}
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "place": 1,
    "squad_id": 42,
    "squad_name": "Dream Team",
    "tour_points": 52,
    "total_points": 135,
    "penalty_points": 4,
    "total_penalty_points": 12
  },
  ...
]
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

```
1. –ò–≥—Ä–æ–∫ –∏–≥—Ä–∞–µ—Ç –º–∞—Ç—á
   ‚îî‚îÄ> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PlayerMatchStats

2. –¢—É—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
   ‚îî‚îÄ> finalize_tour() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (celery –∏–ª–∏ —Ä—É—á–Ω–æ–π API)
       ‚îú‚îÄ> calculate_points() —Å—á–∏—Ç–∞–µ—Ç –æ—á–∫–∏ –∫–∞–∂–¥–æ–≥–æ SquadTour
       ‚îÇ   ‚îî‚îÄ> –°—É–º–º–∏—Ä—É–µ—Ç –æ—á–∫–∏ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –∑–∞ –º–∞—Ç—á–∏ —Ç—É—Ä–∞
       ‚îú‚îÄ> –°–æ—Ö—Ä–∞–Ω—è–µ—Ç points –≤ SquadTour.points
       ‚îî‚îÄ> –ü–æ–º–µ—á–∞–µ—Ç is_finalized = True

3. –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è
   ‚îî‚îÄ> calculate_squad_points_bulk()
       ‚îú‚îÄ> SUM(points) ‚Üí total_earned
       ‚îú‚îÄ> SUM(penalty_points) ‚Üí total_penalty
       ‚îî‚îÄ> total_net = total_earned - total_penalty

4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (Frontend)
   ‚îî‚îÄ> –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∫–∞–ø–∏—Ç–∞–Ω–∞/–±—É—Å—Ç–æ–≤ –∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º –æ—á–∫–∞–º
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

‚úÖ **–û—á–∫–∏ –∑–∞ —Ç—É—Ä** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **1 —Ä–∞–∑** –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –±–æ–ª—å—à–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è  
‚úÖ **–®—Ç—Ä–∞—Ñ—ã** –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è **—Å—Ä–∞–∑—É** –ø—Ä–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞—Ö –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `SquadTour.penalty_points`  
‚úÖ **Total Points** ‚Äî —ç—Ç–æ **SUM** –≤—Å–µ—Ö `SquadTour.points` –¥–ª—è –∫–æ–º–∞–Ω–¥—ã  
‚úÖ **Total Penalty** ‚Äî —ç—Ç–æ **SUM** –≤—Å–µ—Ö `SquadTour.penalty_points`  
‚úÖ **–õ–∏–¥–µ—Ä–±–æ—Ä–¥** —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ **`total_net = total_earned - total_penalty`**  
‚úÖ **–ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –∫–∞–ø–∏—Ç–∞–Ω–∞/–±—É—Å—Ç–æ–≤** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ **—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è  

---

## üìù –§–∞–π–ª—ã —Å –ª–æ–≥–∏–∫–æ–π

### Backend
- `app/utils/count_points.py` ‚Äî —Ä–∞—Å—á—ë—Ç –±–∞–∑–æ–≤—ã—Ö –æ—á–∫–æ–≤ –∏–≥—Ä–æ–∫–∞
- `app/squad_tours/models.py:123-144` ‚Äî –º–µ—Ç–æ–¥ `calculate_points()` –¥–ª—è —Ç—É—Ä–∞
- `app/squads/services.py:792-868` ‚Äî bulk —Ä–∞—Å—á—ë—Ç –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—á–∫–æ–≤
- `app/squads/services.py:1193-1298` ‚Äî —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É—Ä–∞
- `app/squads/services.py:941-1120` ‚Äî –ª–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –∏ —à—Ç—Ä–∞—Ñ–æ–≤

### Frontend
- `src/lib/pointsCalculation.ts:47-73` ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –æ—á–∫–æ–≤ —Å –º–Ω–æ–∂–∏—Ç–µ–ª—è–º–∏
- `src/lib/squadAdapter.ts:149-171` ‚Äî helpers –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—á–∫–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- `src/lib/api.ts:207-275` ‚Äî —Ç–∏–ø—ã LeaderboardEntry —Å –ø–æ–ª—è–º–∏ –æ—á–∫–æ–≤

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É—Ä–æ–≤ —á–µ—Ä–µ–∑ Celery
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—É—Å—Ç–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ)
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤ (audit log)
- [ ] –ë–æ–Ω—É—Å—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (clean sheet, hat-trick)
